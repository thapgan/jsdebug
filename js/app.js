function print(){for(var e="",t=0;t<arguments.length;t++)e=e+arguments[t]+" ";return e}function initExecEnv(){var e=document.getElementById("environmentForExecution");e&&e.parentNode.removeChild(e);var t=document.createElement("iframe");t.id="environmentForExecution",t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var n=t.contentWindow,a=n.eval,r=n.execScript;return!a&&r&&(r.call(n,"null"),a=n.eval),n.customizedEval=a,n.print=print,n}function copyField(e,t){Object.keys(e).length&&Object.keys(e).forEach(function(n){t[n]=e[n]})}function copyWin2Context(e,t,n){var a=n;Object.keys(e).forEach(function(n){Object.keys(t).length?(n in t||a.indexOf(n)===-1)&&(t[n]=e[n]):a.indexOf(n)===-1&&(t[n]=e[n])})}function initDrag(e){startX=e.clientX,startY=e.clientY,prSibling=e.target.previousElementSibling,nextSibling=e.target.nextElementSibling,"separaterLR"===e.target.id?(resizeDirection=!0,prWidth=parseInt(window.getComputedStyle(prSibling).width,10),nextWidth=parseInt(window.getComputedStyle(nextSibling).width,10)):(resizeDirection=!1,prHeight=parseInt(window.getComputedStyle(prSibling).height,10),nextHeight=parseInt(window.getComputedStyle(nextSibling).height,10)),document.documentElement.addEventListener("mousemove",doDrag,!1),document.documentElement.addEventListener("mouseup",stopDrag,!1)}function expand(e){e.target.nextElementSibling.style.display="none",e.target.style.display="none","separaterLR"===e.target.id?e.target.previousElementSibling.style.width="100%":e.target.previousElementSibling.style.height="100%"}function doDrag(e){resizeDirection?(prSibling.style.width=prWidth+e.clientX-startX+"px",nextSibling.style.width=nextWidth-e.clientX+startX+"px"):(prSibling.style.height=prHeight+e.clientY-startY+"px",nextSibling.style.height=nextHeight-e.clientY+startY+"px")}function stopDrag(e){document.documentElement.removeEventListener("mousemove",doDrag,!1),document.documentElement.removeEventListener("mouseup",stopDrag,!1),$("#outputView").slimScroll({height:"auto"})}function naviTo(e){document.getElementById("aboutMenu").classList.remove("active"),document.getElementById("consoleMenu").classList.remove("active"),document.getElementById("outputMenu").classList.remove("active"),1==e?(document.getElementById("aboutMenu").className+=" active",document.getElementById("outputView").style.display="none",document.getElementById("outputView").parentNode.style.display="none",document.getElementById("consoleView").style.display="none",document.getElementById("aboutMeView").style.display="block"):2==e?(document.getElementById("consoleMenu").className+=" active",document.getElementById("outputView").style.display="none",document.getElementById("outputView").parentNode.style.display="none",document.getElementById("aboutMeView").style.display="none",document.getElementById("consoleView").style.display="block"):3==e&&(document.getElementById("outputMenu").className+=" active",document.getElementById("consoleView").style.display="none",document.getElementById("aboutMeView").style.display="none",document.getElementById("outputView").style.display="block",document.getElementById("outputView").parentNode.style.display="block")}function treeClick(){$("#stackView").slimScroll({height:"auto",start:"bottom"})}function removeMark(){marker&&(editor.getSession().removeMarker(marker),marker=null)}function highlightMarkedRange(e,t,n,a){marker=editor.session.addMarker(new Range(e,t,n,a),"nextExecMarker","text"),editor.scrollToLine(n,!0,!0,function(){});var r=editor.session.getBreakpoints(e,0);return"undefined"!=typeof r[e]}function MarkBlockStatement(e){return void 0===e.index&&(e.index=0),markStatement(e.index<e.body.length?e.body[e.index]:executionStack[executionStack.length-2])}function MarkExpressionStatement(e){return markStatement("SequenceExpression"===e.expression.type?e.expression.expressions[0]:e.expression)}function MarkVariableDeclaration(e){void 0===e.index&&(e.index=0);var t=e.declarations[e.index];return 0==e.index&&(t.sline=e.loc.start.line,t.scol=e.loc.start.column),markStatement(e.declarations[e.index])}function MarkVariableDeclarator(e){if(e.init&&"Literal"!=e.init.type&&"Identifier"!=e.init.type){var t=e.init;t.unMarkable=!0;var n=markStatement(t);if(n.marked)return n}if(e.unMarkable)return{marked:!1,pause:!1};var a,r,i,o;return e.sline?(a=e.sline-1,r=e.scol):(a=e.loc.start.line-1,r=e.loc.start.column),i=e.loc.end.line-1,o=e.loc.end.column,{marked:!0,pause:highlightMarkedRange(a,r,i,o)}}function MarkBinaryExpression(e){if(e.right&&"Literal"!=e.right.type&&"Identifier"!=e.right.type){var t=e.right;t.unMarkable=!0;var n=markStatement(t);if(n.marked)return n}if(e.left&&"Literal"!=e.left.type&&"Identifier"!=e.left.type){var t=e.left;t.unMarkable=!0;var n=markStatement(t);if(n.marked)return n}if(e.unMarkable)return{marked:!1,pause:!1};var a,r,i,o;return a=e.loc.start.line-1,r=e.loc.start.column,i=e.loc.end.line-1,o=e.loc.end.column,{marked:!0,pause:highlightMarkedRange(a,r,i,o)}}function MarkUnaryExpression(e){if(e.argument&&"Literal"!=e.argument.type&&"Identifier"!=e.argument.type){var t=e.argument;t.unMarkable=!0;var n=markStatement(t);if(n.marked)return n}if(e.unMarkable)return{marked:!1,pause:!1};var a,r,i,o;return a=e.loc.start.line-1,r=e.loc.start.column,i=e.loc.end.line-1,o=e.loc.end.column,{marked:!0,pause:highlightMarkedRange(a,r,i,o)}}function MarkCallExpression(e){e.index||(e.index=0);for(var t=e.index;t<e.arguments.length;){if("Literal"!=e.arguments[t].type&&"Identifier"!=e.arguments[t].type){var n=e.arguments[t];if("CallExpression"==n.type)return markStatement(n)}t++}var a,r,i,o;return a=e.loc.start.line-1,r=e.loc.start.column,i=e.loc.end.line-1,o=e.loc.end.column,{marked:!0,pause:highlightMarkedRange(a,r,i,o)}}function MarkReturnStatement(e){if(e.argument&&"Literal"!=e.argument.type&&"Identifier"!=e.argument.type){var t=e.argument;t.unMarkable=!0;var n=markStatement(t);if(n.marked)return n}if(e.unMarkable)return{marked:!1,pause:!1};var a,r,i,o;return a=e.loc.start.line-1,r=e.loc.start.column,i=e.loc.end.line-1,o=e.loc.end.column,{marked:!0,pause:highlightMarkedRange(a,r,i,o)}}function MarkLiteralIdentifier(e){if(e.unMarkable)return{marked:!1,pause:!1};var t,n,a,r;return t=e.loc.start.line-1,n=e.loc.start.column,a=e.loc.end.line-1,r=e.loc.end.column,{marked:!0,pause:highlightMarkedRange(t,n,a,r)}}function MarkAssignmentExpression(e){if(e.right&&"Literal"!=e.right.type&&"Identifier"!=e.right.type){var t=e.right;t.unMarkable=!0;var n=markStatement(t);if(n.marked)return n}if(e.unMarkable)return{marked:!1,pause:!1};var a,r,i,o;return a=e.loc.start.line-1,r=e.loc.start.column,i=e.loc.end.line-1,o=e.loc.end.column,{marked:!0,pause:highlightMarkedRange(a,r,i,o)}}function markStatement(e){if(e)switch(e.type){case"WhileStatement":case"IfStatement":return markStatement(e.test);case"DoWhileStatement":return markStatement(e.firstRunFlag?e.test:e.body);case"BlockStatement":return MarkBlockStatement(e);case"ReturnStatement":return MarkReturnStatement(e);case"ExpressionStatement":return MarkExpressionStatement(e);case"VariableDeclaration":return MarkVariableDeclaration(e);case"VariableDeclarator":return MarkVariableDeclarator(e);case"LogicalExpression":case"BinaryExpression":return MarkBinaryExpression(e);case"UnaryExpression":return MarkUnaryExpression(e);case"CallExpression":return MarkCallExpression(e);case"AssignmentExpression":return MarkAssignmentExpression(e);case"UpdateExpression":case"Literal":case"Identifier":return MarkLiteralIdentifier(e)}return{marked:!1,pause:!1}}function processError(e,t){errorFlag=e.message,editor.getSession().setAnnotations([{row:t,text:errorFlag,type:"error"}])}function initExecution(){clearOutput(),pauseFlag=!1,errorFlag=!1,continuable=!0;var e=editor.getValue().trim();if(""!=e){var t=esprima.parse(e,esprimaOptions).body;funcNames=[],funcDeclarations=[];var n=[];t.forEach(function(e){"FunctionDeclaration"==e.type?(funcDeclarations.push(e),funcNames.push(e.id.name)):n.push(e)}),executionStack=[],executionStack.push({type:"BlockStatement",body:n,index:0}),win=initExecEnv(),standardWinKeys=Object.keys(win),contextStack=[],contextStack.push({contextType_env_101010:"Main stack"}),removeMark(),markStatement(executionStack[0])}}function updateReturnValue(e,t){return"arguments"==e.returnPath?executionStack[executionStack.length-1].arguments[e.returnPathIndex]={type:"Literal",value:t,raw:t}:executionStack[executionStack.length-1][e.returnPath]={type:"Literal",value:t,raw:t},("CallExpression"==e.type||e.funcFlag)&&(executionStack[executionStack.length-1].funcFlag=!0),!(!executionStack[executionStack.length-1].unMarkable&&("CallExpression"==e.type||e.funcFlag))||(removeMark(),markStatement(executionStack[executionStack.length-1]).pause&&(pauseFlag=!0),!1)}function evalStatement(e,t){var n=contextStack.pop();copyField(n,win);var a;try{a=win.customizedEval.call(win,e)}catch(e){processError(e,t)}return copyWin2Context(win,n,standardWinKeys),contextStack.push(n),drawStackTree(),a}function evalBlockStatement(e){var t=e.body[e.index];e.index++,e.index<e.body.length&&executionStack.push(e),t&&executionStack.push(t)}function evalIfSatement(e){if("Literal"!=e.test.type&&"Identifier"!=e.test.type){var t=e.test;return t.unMarkable=!0,t.returnPath="test",executionStack.push(e),executionStack.push(t),!0}var n="Literal"===e.test.type?e.test.value:contextStack[contextStack.length-1][e.test.name];if(n){if(e.consequent){var t={type:"BlockStatement",body:[],index:0};"BlockStatement"!=e.consequent.type?t.body.push(e.consequent):t.body=e.consequent.body,executionStack.push(t)}return!1}if(e.alternate){var t={type:"BlockStatement",body:[],index:0};"BlockStatement"!=e.alternate.type?t.body.push(e.alternate):t.body=e.alternate.body,executionStack.push(t)}return!1}function evalWhileStatement(e){if(e.storedTest||(e.storedTest=JSON.stringify(e.test),e.tmpBody=JSON.stringify(e.body)),"Literal"!=e.test.type&&"Identifier"!=e.test.type){var t=e.test;return t.unMarkable=!0,t.returnPath="test",executionStack.push(e),executionStack.push(t),!0}var n="Literal"===e.test.type?e.test.value:contextStack[contextStack.length-1][e.test.name];if(n){var t={type:"BlockStatement",body:[],index:0},a=JSON.parse(e.tmpBody);return"BlockStatement"!=a.type?t.body.push(a):t=a,e.test=JSON.parse(e.storedTest),executionStack.push(e),executionStack.push(t),!1}return!1}function evalDoWhileStatement(e){e.storedTest||(e.storedTest=JSON.stringify(e.test),e.tmpBody=JSON.stringify(e.body));var t=!0;if(e.firstRunFlag){if("Literal"!=e.test.type&&"Identifier"!=e.test.type){var n=e.test;return n.unMarkable=!0,n.returnPath="test",executionStack.push(e),executionStack.push(n),!0}t="Literal"===e.test.type?e.test.value:contextStack[contextStack.length-1][e.test.name]}else e.firstRunFlag=!0;if(t){var n={type:"BlockStatement",body:[],index:0},a=JSON.parse(e.tmpBody);"BlockStatement"!=a.type?n.body.push(a):n=a,e.test=JSON.parse(e.storedTest),executionStack.push(e),executionStack.push(n)}return!1}function evalVariableDeclaration(e){var t=e.declarations[e.index];e.index++,e.index<e.declarations.length&&executionStack.push(e),t&&executionStack.push(t)}function evalVariableDeclarator(e){if(e.init&&"Literal"!=e.init.type&&"Identifier"!=e.init.type){var t=e.init;return t.returnPath="init",t.unMarkable=!0,executionStack.push(e),executionStack.push(t),!0}var n;return n=e.init?"Identifier"==e.init.type?"var "+e.id.name+" = "+e.init.name:"var "+e.id.name+" = "+(isNaN(e.init.raw)?"'"+e.init.raw+"'":e.init.raw):"var "+e.id.name,evalStatement(n,e.loc.start.line-1),!1}function evalBinaryExpression(e){if(e.right&&"Literal"!=e.right.type&&"Identifier"!=e.right.type){var t=e.right;return t.returnPath="right",t.unMarkable=!0,executionStack.push(e),executionStack.push(t),!0}if(e.left&&"Literal"!=e.left.type&&"Identifier"!=e.left.type){var t=e.left;return t.returnPath="left",t.unMarkable=!0,executionStack.push(e),executionStack.push(t),!0}var n=("Literal"==e.left.type?e.left.raw:e.left.name)+e.operator+("Literal"==e.right.type?e.right.raw:e.right.name),a=evalStatement(n,e.loc.start.line-1);return!!e.returnPath&&updateReturnValue(e,a)}function evalUnaryExpression(e){if(e.argument&&"Literal"!=e.argument.type&&"Identifier"!=e.argument.type){var t=e.argument;return t.returnPath="argument",t.unMarkable=!0,executionStack.push(e),executionStack.push(t),!0}var n=e.operator+("Literal"==e.argument.type?e.argument.raw:e.argument.name),a=evalStatement(n,e.loc.start.line-1);return!!e.returnPath&&updateReturnValue(e,a)}function evalUpdateExpression(e){var t=e.prefix?e.operator+e.argument.name:e.argument.name+e.operator;if(e.prefix){var n=evalStatement(t,e.loc.start.line-1);return e.returnPath?(executionStack[executionStack.length-1][e.returnPath]={type:"Literal",value:n,raw:n},!0):(evalStatement(t,e.loc.start.line-1),!1)}if(e.returnPath){var a=contextStack[contextStack.length-1][e.argument.name];return executionStack[executionStack.length-1][e.returnPath]={type:"Literal",value:a,raw:a},evalStatement(t,e.loc.start.line-1),!0}return evalStatement(t,e.loc.start.line-1),!1}function evalAssignmentExpression(e){if(e.right&&"Literal"!=e.right.type&&"Identifier"!=e.right.type){var t=e.right;return t.returnPath="right",t.unMarkable=!0,executionStack.push(e),executionStack.push(t),!0}var n=e.left.name+e.operator;n+="Literal"==e.right.type?isNaN(e.right.raw)?"'"+e.right.raw+"'":e.right.raw:e.right.name;var a=evalStatement(n,e.loc.start.line-1);return!!e.returnPath&&(a=contextStack[contextStack.length-1][e.left.name],updateReturnValue(e,a))}function evalExpressionStatement(e){if(e.expression){if("SequenceExpression"===e.expression.type){var t={type:"BlockStatement",body:e.expression.expressions,index:0};executionStack.push(t)}else{var t=e.expression;executionStack.push(t)}return!0}return!1}function evalCallExpression(e){if("print"==e.callee.name){var t=editor.session.getTextRange(new Range(e.loc.start.line-1,e.loc.start.column,e.loc.end.line-1,e.loc.end.column)),n=evalStatement(t,e.loc.start.line-1);return printOutput(n),!1}if("read"==e.callee.name)return pauseFlag=!0,showInputDialog(e.arguments),executionStack.push(e),drawStackTree(),!1;if(e.execfinished)return contextStack.pop(),win=initExecEnv(),drawStackTree(),!!e.returnPath&&updateReturnValue(e,e.returnValue);for(e.index||(e.index=0);e.index<e.arguments.length;){if("Literal"!=e.arguments[e.index].type&&"Identifier"!=e.arguments[e.index].type){var a=e.arguments[e.index];return a.returnPath="arguments",a.returnPathIndex=e.index,a.unMarkable=!0,e.index++,executionStack.push(e),executionStack.push(a),!0}e.index++}var r=funcNames.indexOf(e.callee.name);if(r>-1){for(var i={},o=funcDeclarations[r],c=0;c<e.arguments.length;c++)i[o.params[c].name]="Literal"==e.arguments[c].type?e.arguments[c].raw:contextStack[contextStack.length-1][e.arguments[c].name];i.contextType_env_101010=e.callee.name+" Stack",contextStack.push(i),e.execfinished=!0,executionStack.push(e);var l=JSON.parse(JSON.stringify(o.body));return l.index=0,executionStack.push(l),removeMark(),pauseFlag=markStatement(executionStack[executionStack.length-1]).pause,win=initExecEnv(),drawStackTree(),!1}var t="";e.arguments.forEach(function(e){t=t+("Literal"==e.type?e.raw:e.name)+","}),t=e.callee.name?e.callee.name+"("+t.substring(0,t.length-1)+")":e.callee.object.name+"."+e.callee.property.name+"("+t.substring(0,t.length-1)+")";var n=evalStatement(t,e.loc.start.line-1);return!!e.returnPath&&updateReturnValue(e,n)}function evalReturnStatement(e){if(e.argument&&"Literal"!=e.argument.type&&"Identifier"!=e.argument.type){var t=e.argument;return t.returnPath="argument",t.unMarkable=!0,executionStack.push(e),executionStack.push(t),!0}var t;do if(t=executionStack.pop(),"CallExpression"==t.type)break;while(executionStack.length);return t.returnValue="Literal"==e.argument.type?e.argument.value:contextStack[contextStack.length-1][e.argument.name],executionStack.push(t),!0}function nextStep(){if(executionStack.length){var e=executionStack.pop(),t=!1;switch(e.type){case"DoWhileStatement":t=evalDoWhileStatement(e);break;case"WhileStatement":t=evalWhileStatement(e);break;case"IfStatement":t=evalIfSatement(e);break;case"BlockStatement":evalBlockStatement(e),t=!0;break;case"ExpressionStatement":t=evalExpressionStatement(e);break;case"VariableDeclaration":evalVariableDeclaration(e),t=!0;break;case"VariableDeclarator":t=evalVariableDeclarator(e);break;case"BinaryExpression":t=evalBinaryExpression(e);break;case"UnaryExpression":t=evalUnaryExpression(e);break;case"UpdateExpression":t=evalUpdateExpression(e);break;case"AssignmentExpression":t=evalAssignmentExpression(e);break;case"CallExpression":t=evalCallExpression(e);break;case"ReturnStatement":t=evalReturnStatement(e)}t?nextStep():e.returnPath&&"CallExpression"==e.type||(removeMark(),markStatement(executionStack[executionStack.length-1]).pause&&(pauseFlag=!0))}}function execContinuously(){!errorFlag&&executionStack.length>0&&(nextStep(),pauseFlag||setTimeout(execContinuously,250))}function runCmd(){(continuable||errorFlag||!executionStack.length||pauseFlag)&&(errorFlag||!executionStack.length?(initExecution(),continuable=!1,setTimeout(execContinuously,250)):(pauseFlag=!1,continuable=!1,execContinuously()))}function stepCmd(){errorFlag||!executionStack.length?initExecution():nextStep()}function pauseCmd(){pauseFlag=!0}function printOutput(e){var t=document.createElement("tr");t.innerHTML="<td>"+e+"</td>",document.getElementById("outputBody").appendChild(t),setTimeout(function(){var e=$("#outputView")[0].scrollHeight;$("#outputView").slimScroll({scrollTo:e})},0)}function check(e){switch(e){case 115:pauseFlag=!0;break;case 120:stepCmd();break;case 121:runCmd()}}function clearOutput(){document.getElementById("outputBody").innerHTML=""}function showInputDialog(e){iobusy=!0;var t=document.getElementById("formData");t.innerHTML="";for(var n=0;n<e.length;n++){var a="<label class='col-sm-2 control-label'>"+e[n].name+"</label><div class='col-sm-10'>";a=a+"<input class='form-control' placeholder='"+e[n].name+"' id='"+e[n].name+"'></div>";var r=document.createElement("div");r.className="form-group",r.innerHTML=a,t.appendChild(r)}var a="<div class='col-sm-offset-2 col-sm-10'><button class='btn btn-default' style='float:right;' onclick='getData()'>OK</button></div>",r=document.createElement("div");r.className="form-group",r.innerHTML=a,t.appendChild(r),document.getElementById("myModal").style.display="block"}function getData(){for(var e=executionStack.pop(),t=0;t<e.arguments.length;t++){var n=document.getElementById(e.arguments[t].name).value;contextStack[contextStack.length-1][e.arguments[t].name]=isNaN(n)?n:Number(n)}document.getElementById("myModal").style.display="none",removeMark(),pauseFlag=markStatement(executionStack[executionStack.length-1]).pause,continuable=!0,drawStackTree()}function drawObject(e,t,n){var a=document.createElement("ol");if(Object.keys(e).forEach(function(t){if("contextType_env_101010"!=t&&"function"!=typeof e[t])if("object"==typeof e[t]){var r=drawObject(e[t],!0,n+t);a.appendChild(r)}else{var i=document.createElement("li");i.className="sType",i.innerHTML="<div><div class='col-sm-4' style='color:#f79a0e'>"+t+"</div><div class='col-sm-8'>"+e[t]+"</div></div>",a.appendChild(i)}}),t){var r=document.createElement("li"),i=document.createElement("label");i.htmlFor=n,i.innerHTML=n,r.appendChild(i);var o=document.createElement("input");return o.type="checkbox",o.id=n,o.onchange=treeClick,o.checked=!0,r.appendChild(o),r.appendChild(a),r}return a}function drawStackTree(){var e=document.getElementById("stackTree");e.innerHTML="",contextStack.forEach(function(t,n){var a=document.createElement("li"),r=document.createElement("label");r.htmlFor="stack"+n,r.innerHTML=t.contextType_env_101010,a.appendChild(r);var i=document.createElement("input");i.type="checkbox",i.id="stack"+n,i.onchange=treeClick,i.checked=!0,a.appendChild(i),Object.keys(t).length&&a.appendChild(drawObject(t,!1,"stack"+n)),e.appendChild(a)})}var startX,startY,prWidth,nextWidth,prHeight,nextHeight,resizeDirection,prSibling,nextSibling;naviTo(3);var editor=ace.edit("editor"),Range=ace.require("ace/range").Range,marker=null;editor.setTheme("ace/theme/xcode"),editor.getSession().setMode("ace/mode/javascript"),editor.on("guttermousedown",function(e){var t=e.domEvent.target;if(t.className.indexOf("ace_gutter-cell")!=-1&&editor.isFocused()&&!(e.clientX>25+t.getBoundingClientRect().left)){var n=e.getDocumentPosition().row,a=e.editor.session.getBreakpoints(n,0);"undefined"==typeof a[n]?e.editor.session.setBreakpoint(n):e.editor.session.clearBreakpoint(n),e.stop()}}),esprimaOptions={attachComment:!1,range:!1,loc:!0,sourceType:"script"};var win={},standardWinKeys=[],contextStack=[],executionStack=[],pauseFlag=!1,errorFlag=!1,continuable=!0,funcNames=[],funcDeclarations=[];document.addEventListener("keydown",function(e){check(e.keyCode)});